{"version":3,"file":"lite-spotify-embed.js","sourceRoot":"","sources":["lite-spotify-embed.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * OBJETIVO:\n * Cargar version ligera del frame, utlizando una fakeFrame que utilice los recursos minimos (estilos, imagenes) que provea spotify.\n * Donde solo al reproducir el frame se descargue todos los recursos necesarios.\n * **/\n\n//Crear la clase\ninterface ContentIframe {\n  img: {\n    height: number;\n    width: number;\n    url: string;\n  };\n  title: string;\n  iframeURL: string;\n  height: number;\n}\n\nclass LiteSpotifyEmbed extends HTMLElement {\n  private $wrapper!: HTMLDivElement;\n  private $btnPlay!: HTMLButtonElement;\n  private _bgColor: string;\n  private tokenId: string;\n  private contentType: 'show' | 'track' | 'play-list' | 'episode' | null;\n  private content!: ContentIframe;\n\n  [key: string]: any;\n\n  constructor() {\n    super();\n    this._bgColor = '#4d4f51';\n    this.tokenId = '';\n    this.contentType = null;\n    this.setDOM();\n  }\n\n  get bgColor(): string {\n    return this._bgColor;\n  }\n\n  set bgColor(val: string) {\n    this._bgColor = val;\n    this.updateBgColor();\n  }\n\n  checkAttributteAndFetch() {\n    if (this.tokenId && this.contentType) {\n      this.fetchSpotify();\n    }\n  }\n\n  insertGlobalStyles() {\n    // Verifica si los estilos ya han sido agregados\n    if (document.getElementById('lite-spotify-embed-styles')) return;\n    const styleElement = document.createElement('style');\n    styleElement.id = 'lite-spotify-embed-styles';\n    styleElement.textContent = `\n        @font-face {\n          font-family: CircularSp;\n          font-weight: 400;\n          font-display: swap;\n          src: url('https://encore.scdn.co/fonts/CircularSp-Book-a00e99ef9996a3a157fb6b746856d04f.woff2') format('woff2');\n        }\n        @font-face {\n          font-family: CircularSpBold;\n          font-weight: 400;\n          font-display: swap;\n          src: url('https://encore.scdn.co/fonts/CircularSp-Arab-Bold-c638a17a6708a3bd51bd2422c3fedcfb.woff2') format('woff2');\n        }\n      `;\n    document.head.appendChild(styleElement);\n  }\n  setDOM() {\n    this.insertGlobalStyles();\n    const shadowDOM = this.attachShadow({ mode: 'open' });\n    shadowDOM.innerHTML = `\n            <div id=\"wrapper\">\n                <div id=\"frame-fake\">\n                    <img src=\"#\" class=\"thumb\"loading=\"lazy\" />\n                    <div class=\"desc\">\n                    <span class=\"logo\">\n                        <svg data-encore-id=\"icon\" role=\"img\" \n                            aria-hidden=\"true\" viewBox=\"0 0 24 24\">\n                            <path d=\"M12 1a11 11 0 1 0 0 22 11 11 0 0 0 0-22zm5.045 15.866a.686.686 0 0 1-.943.228c-2.583-1.579-5.834-1.935-9.663-1.06a.686.686 0 0 1-.306-1.337c4.19-.958 7.785-.546 10.684 1.226a.686.686 0 0 1 .228.943zm1.346-2.995a.858.858 0 0 1-1.18.282c-2.956-1.817-7.464-2.344-10.961-1.282a.856.856 0 0 1-1.11-.904.858.858 0 0 1 .611-.737c3.996-1.212 8.962-.625 12.357 1.462a.857.857 0 0 1 .283 1.179zm.116-3.119c-3.546-2.106-9.395-2.3-12.78-1.272a1.029 1.029 0 0 1-.597-1.969c3.886-1.18 10.345-.952 14.427 1.471a1.029 1.029 0 0 1-1.05 1.77z\"></path>\n                        </svg>\n                    </span>\n                        <p class=\"title\"></p>\n                        <button class=\"btn-play\" aria-label=\"Reproducir\" disabled>\n                            <svg data-encore-id=\"icon\" role=\"img\" aria-hidden=\"false\" \n                                viewBox=\"0 0 24 24\">\n                                <title>Reproducir</title>\n                                <path d=\"M1 12C1 5.925 5.925 1 12 1s11 4.925 11 11-4.925 11-11 11S1 18.075 1 12zm8.75-4.567a.5.5 0 0 0-.75.433v8.268a.5.5 0 0 0 .75.433l7.161-4.134a.5.5 0 0 0 0-.866L9.75 7.433z\"></path>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <style>\n                #wrapper {\n                    position: relative;\n                    & > * {\n                      box-sizing: border-box;\n                    }\n                }\n                \n                #frame-fake {\n                    background-color: ${this._bgColor};\n                    border-radius: 12px;\n                    padding: 16px;\n                    display: flex;\n                    gap: 20px;\n                    .thumb {\n                      min-width: 120px;\n                      min-height: 120px;\n                      border-radius: 12px;\n                      object-fit: cover;\n                      transition: width .3s ease, height .3s ease ;\n                      box-shadow: 0 9px 9px 0 #0000001a, 0 0 29px 0 #0000001a;\n                    }\n                    .desc {\n                        display: flex;\n                        justify-content: space-between;\n                        width: 100%;\n                        flex-direction: column;\n                        color: #fff;\n                        overflow: hidden;\n                        .title {\n                            font-family: CircularSp,CircularSpBold,sans-serif;\n                            margin: 0;\n                            font-size: 0.875rem;\n                            display: initial;\n                            white-space: nowrap;\n                            overflow-x: hidden;\n                            &:hover {\n                                text-decoration: underline;\n                            }\n                        }\n                        svg {\n                            width:100%;\n                            height: 100%;\n                            fill: #fff;\n                        }\n                        .btn-play {\n                            border: 0;\n                            background-color: transparent;\n                            outline: 0;\n                            margin-left: auto;\n                            width: 1.938rem;\n                            height: 1.938rem;\n                            padding: 0;\n                            transition: transform .3s ease;\n                            cursor: pointer;\n                            &:hover {\n                                transform: scale(1.1);\n                            }\n                            &:disabled svg {\n                              fill: #9d9d9dc4;\n                            }\n                        }\n                        .logo {\n                            margin-left: auto;\n                            width: 1.5rem;\n                            height: 1.5rem;\n                           \n                        }\n                    }\n                }\n\n                @media screen and (max-width: 524px) {\n                     #frame-fake  {\n                        .desc {\n                            width: calc(100%);\n                            .title  {\n                                text-align: center;\n                                \n                            }\n                        }\n                    }                     \n                }\n                @media screen and (max-height: 351px) {\n                  #frame-fake .thumb {\n                    width: 200px;\n                    height: 200px;\n                  }\n                }\n                @media screen and (max-height: 231px) {\n                  #frame-fake .thumb {\n                    width: 120px;\n                    height: 120px;\n                  }\n                }\n            </style>\n        `;\n    this.$wrapper = shadowDOM.querySelector('#wrapper')!;\n    this.$btnPlay = shadowDOM.querySelector('.btn-play')!;\n  }\n  async fetchSpotify() {\n    try {\n      const response = await fetch(\n        `https://open.spotify.com/oembed?url=https%3A%2F%2Fopen.spotify.com%2F${this.contentType}%2F${this.tokenId}`,\n      );\n      if (!response.ok) throw new Error(response.statusText);\n      const data = await response.json();\n      this.content = {\n        img: {\n          url: data.thumbnail_url,\n          height: data.thumbnail_height,\n          width: data.thumbnail_width,\n        },\n        title: data.title,\n        iframeURL: data.iframe_url,\n        height: data.height,\n      };\n      this.updateFrameFake();\n    } catch (err) {\n      alert('Error to load resource iframe: ' + err);\n    }\n  }\n  updateBgColor() {\n    this.$wrapper.querySelector<HTMLDivElement>(\n      '#frame-fake',\n    )!.style.backgroundColor = this.bgColor;\n  }\n  updateFrameFake() {\n    if (this.content.img.url) {\n      const $thumb =\n        this.$wrapper.querySelector<HTMLImageElement>('#frame-fake .thumb');\n      $thumb!.src = this.content.img.url;\n    }\n    if (this.content.title) {\n      this.$wrapper.querySelector<HTMLParagraphElement>(\n        '#frame-fake .title',\n      )!.textContent = this.content.title;\n    }\n    if (this.content.iframeURL) {\n      this.$wrapper.querySelector<HTMLButtonElement>(\n        '#frame-fake .btn-play',\n      )!.disabled = false;\n    }\n    if (this.content.height) {\n      this.$wrapper.querySelector<HTMLDivElement>('#frame-fake')!.style.height =\n        `${this.content.height}px`;\n    }\n  }\n\n  addIframe() {\n    const $iframeHTML = `\n\t\t\t<iframe \n\t\t\tstyle=\"border-radius: 12px; position: absolute; z-index: 1; left: 0;top:0;\" \n      src=\"${this.content.iframeURL}\" \n      width=\"100%\" height=\"${this.content.height}\" \n      frameBorder=\"0\" \n      allowfullscreen=\"\" \n      allow=\"autoplay; \n      clipboard-write; \n      encrypted-media;\n      fullscreen;picture-in-picture\" \n      loading=\"lazy\"></iframe>\n\t\t\t`;\n    this.$wrapper.insertAdjacentHTML('beforeend', $iframeHTML);\n  }\n  static get observedAttributes() {\n    return ['bg-color', 'token-id', 'content-type'];\n  }\n\n  connectedCallback() {\n    this.$btnPlay.addEventListener('click', evt => {\n      evt.preventDefault();\n      this.addIframe();\n    });\n  }\n  attributeChangedCallback(\n    property: string,\n    oldValue: string | number | undefined,\n    newValue: string | number | undefined,\n  ) {\n    if (oldValue === newValue) return;\n    const propFormated =\n      /^[Aa-zZ\\-]+$/.test(property) &&\n      property.replace(/-([a-z])/g, g => g[1].toUpperCase());\n    if (propFormated) this[propFormated] = newValue;\n    this.checkAttributteAndFetch();\n  }\n}\ncustomElements.define('lite-spotify-embed', LiteSpotifyEmbed);\n// Agregar el frame al click o al mostrarse en pantalla\n// Prefect de todas la urls importantes\n"]}